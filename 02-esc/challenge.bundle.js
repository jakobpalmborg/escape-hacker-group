(()=>{"use strict";let e,t,n,a,i,l,s,c,o,d,r=[];function u(e){const t=(new Date).toLocaleDateString();l=parseInt(e.target.dataset.id),s=e.target.dataset.minparticipants,c=e.target.dataset.maxparticipants,d=e.target.dataset.title;let n=document.querySelector("body");o=document.createElement("div"),o.className="modal-div",o.innerHTML=`\n\t\t<div class="modalContents">\n        <div class="bookingStep1Content">\n        <h1>Book room "${d}" (step 1)</h1>\n        <h2>What date would you like to come?</h2>\n        <form action="">\n            <label class="modalInputLabels" for="date">Date</label>\n\t\t\t<br>\n            <input id="date" class="input-field" type="date" name="date"\n            min="${t}">\n            <input id="firstButton" type="submit" value="Search available times" class="button primary open-modal-step-2">\n        </form>\n        </div>\n\t\t</div>\n    `,n.appendChild(o),document.querySelector(".open-modal-step-2").addEventListener("click",p),(document.querySelector(".modal-div").style.position="fixed")&&(document.querySelector("body").style.overflow="hidden")}function p(e){e.preventDefault();let t=!1,n=document.querySelector("#date");if(""==n.value){function a(){n.style.outline="none"}n.style.outline="solid 2px red",n.addEventListener("click",a)}""!==n.value&&(t=!0),t&&(i=document.querySelector("#date").value,async function(e,t){const n=await fetch(`https://lernia-sjj-assignments.vercel.app/api/booking/available-times?date=${e}&challenge=${t}`);(await n.json()).slots.forEach((e=>{!function(e){let t=document.createElement("option");t.innerHTML=e,document.querySelector("#time").appendChild(t)}(e)}))}(i,l),function(e){e.preventDefault(),o.innerHTML=`\n\t\t<div class="modalContents">\n        <div class="bookingStep2Content">\n        <h1>Book room "${d}" (step 2)</h1>\n        <form action="">\n            <label class="modalInputLabels" for="name">Name</label>\n\t\t\t<br>\n            <input class="input-field" type="text" id="name" name="name">\n\t\t\t<br>\n            <label class="modalInputLabels" for="e-mail">E-mail</label>\n\t\t\t<br>\n            <input class="input-field" type="email" id="e-mail" name="e-mail">\n\t\t\t<br>\n            <label class="modalInputLabels" for="time">What time?</label>\n\t\t\t<br>\n            <select class="input-field" name="time" id="time">\n            </select>\n\t\t\t<br>\n            <label class="modalInputLabels" for="participants">How many participants?</label>\n\t\t\t<br>\n            <select class="input-field" name="participants" id="participants">\n            </select>\n            <input id="secondButton" class="button primary open-modal-step-3" type="submit" value="Submit booking">\n        </form>\n        </div>\n\t\t</div>\n    `,function(e,t){let n=t-e;for(let t=0;t<=n;t++)a(),e++;function a(){let t=document.createElement("option");t.innerHTML=`${e} participants`,document.querySelector("#participants").appendChild(t)}}(s,c),document.querySelector(".open-modal-step-3").addEventListener("click",m)}(e))}function m(s){s.preventDefault();let c=!1,d=document.querySelector("#name"),r=document.querySelector("#e-mail");if(""==d.value){function u(){d.style.outline="none"}d.style.outline="solid 2px red",d.addEventListener("click",u)}else if(""==r.value){function p(){r.style.outline="none"}r.style.outline="solid 2px red",r.addEventListener("click",p)}else c=!0;c&&(e=document.querySelector("#name").value,t=document.querySelector("#e-mail").value,n=document.querySelector("#time").value,a=parseInt(document.querySelector("#participants").value),async function(){const s=await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:l,name:e,email:t,date:i,time:n,participants:a})}),c=await s.json();console.log(c)}(),function(e){e.preventDefault(),o.innerHTML='\n\t<div class="modalContents">\n\t<div class="bookingStep3Content">\n    <h1>Thank you!</h1>\n    <a href="challenges.html">Back to challenges</a>\n    </div>\n\t</div>\n'}(s))}function h(e,t){return!(t.includes("tags:")&&!e.labels.includes(t.substring(5)))}function f(e,t){const n=e.title.concat(" ",e.description).toLowerCase().split(/[ ,]+/);return!!t.toLowerCase().split(/[ ,]+/).every((e=>n.find((t=>{if(t.includes(e))return!0}))))}const v=document.querySelector(".challenge-list"),y=document.querySelector("#btnFilterChallenges"),g=document.querySelector(".filter-close");y.addEventListener("click",(()=>{L.classList.toggle("open"),L.classList.contains("open")&&(y.style.display="none")})),g.addEventListener("click",(()=>{L.classList.toggle("open"),L.classList.contains("open")||(y.style.display="block")}));const L=document.querySelector(".filter-form"),b=document.querySelector("input[type='search']");document.querySelector(".filter-clear").addEventListener("click",(function(){L.reset(),w(k)})),L.addEventListener("submit",(function(e){e.preventDefault()})),L.addEventListener("change",C),b.addEventListener("keyup",C);let E,k=[];function S(){const e=document.querySelectorAll("input[type=checkbox]");if(window.location.hash){const t=window.location.hash;let n=new Event("change");t.includes("all")?(L.reset(),L.dispatchEvent(n)):t.includes("online")?setTimeout((()=>{e[1].checked&&(e[1].checked=!1),e[0].checked=!0,L.dispatchEvent(n)}),200):t.includes("onsite")&&setTimeout((()=>{e[0].checked&&(e[0].checked=!1),e[1].checked=!0,L.dispatchEvent(n)}),200)}}function w(e){if(v.innerHTML="",0!=e.length)for(let t=0;t<e.length;t++){const{id:n,type:a,rating:i,title:l,description:s,minParticipants:c,maxParticipants:o,image:d,labels:r}=e[t];let p=document.createElement("li");p.classList.add("challenge-item");let m=document.createElement("img");m.classList.add("challenge-image"),m.src=d,p.append(m);let h=document.createElement("img");h.classList.add("room-image"),h.src="onsite"==a?"static/iconOnsite.svg":"static/iconOnline.svg",p.append(h);let f=document.createElement("h3");f.classList.add("challenge-title"),f.textContent=l,p.appendChild(f);let y=document.createElement("ul");y.classList.add("rating");let g=document.createElement("li");g.classList.add("rating-star"),y.appendChild(g);let L=document.createElement("li");L.classList.add("rating-star"),y.appendChild(L);let b=document.createElement("li");b.classList.add("rating-star"),y.appendChild(b);let E=document.createElement("li");E.classList.add("rating-star"),y.appendChild(E);let k=document.createElement("li");k.classList.add("rating-star"),y.appendChild(k),i<1?g.classList.add("rating-star"):1==i||i<2?g.classList.add("active"):2==i||i<3?(g.classList.add("active"),L.classList.add("active")):3==i||i<4?(g.classList.add("active"),L.classList.add("active"),b.classList.add("active")):4==i||i<5?(g.classList.add("active"),L.classList.add("active"),b.classList.add("active"),E.classList.add("active")):(g.classList.add("active"),L.classList.add("active"),b.classList.add("active"),E.classList.add("active"),k.classList.add("active")),p.appendChild(y);let S=document.createElement("small");S.classList.add("challenge-meta"),S.innerHTML=`${c} - ${o} participants`,p.appendChild(S);let w=document.createElement("p");w.classList.add("challenge-description"),w.textContent=s,p.appendChild(w);let C=document.createElement("button");C.classList.add("btnBook","button","primary"),C.setAttribute("data-id",n),C.setAttribute("data-minparticipants",c),C.setAttribute("data-maxparticipants",o),C.setAttribute("data-title",l),C.textContent="onsite"==a?"Book this room":"Take challenge online",p.appendChild(C),C.addEventListener("click",u),v.appendChild(p)}else v.innerHTML="<p class='filter-error'>No matching challenges.</p>"}function C(e){!function(){const e=document.querySelectorAll("input[type=radio]");e.forEach((e=>{e.disabled=!1})),E=null,e.forEach((e=>{e.name.includes("min")&&e.checked&&(E=e.value),e.name.includes("max")&&+e.value<+E&&(e.disabled=!0),e.name.includes("max")&&+e.value<+E&&(e.checked=!1)}))}();let t=[];const n=function(){const e=new FormData(L);let t={};for(const[n,a]of e)""!==a&&(t[n]=a);return t}();k.forEach((e=>{let a=!0,i=!0,l=!0,s=!0;i=function(e,t){return!(t.hasOwnProperty("rating:min")&&+e.rating<+t["rating:min"]||t.hasOwnProperty("rating:max")&&+e.rating>+t["rating:max"])}(e,n),l=function(e,t){return!((!t.hasOwnProperty("type:onsite")||!t.hasOwnProperty("type:online"))&&(t.hasOwnProperty("type:online")&&"online"!=e.type||t.hasOwnProperty("type:onsite")&&"onsite"!=e.type))}(e,n);for(const t in n){if(s=h(e,t),!s)break;if("search"==t&&(a=f(e,n[t]),!a))break}l&&s&&a&&i&&t.push(e)})),w(t)}window.addEventListener("hashchange",S),window.addEventListener("load",(async function(){S();let e=new Set;k.length=0,k=await async function(){const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges");return(await e.json()).challenges.forEach((e=>{r.push(e)})),r}(),k.forEach((t=>{t.labels.forEach((t=>{e.add(t)}))})),w(k),function(e){let t="";e.forEach((e=>{t+=`\n\t\t<input type="checkbox" name="tags:${e}" id="tags:${e}">\n\t\t<label for="tags:${e}">${e}</label>\n\t\t`})),document.querySelector("#tags").innerHTML=t}(e)}))})();